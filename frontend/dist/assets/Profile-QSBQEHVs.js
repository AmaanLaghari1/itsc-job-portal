import{A as w,u as F,f as U,i as $,r as f,H as E,j as e,K as y}from"./index-CFt1f066.js";import{F as O,a as G}from"./formik.esm-DGj08CUs.js";import{F as l}from"./FormControl-CxxYqU6g.js";import{A as j}from"./Alert-CXLFhIlH.js";import{c as B,a as o}from"./index.esm-g-bgoICI.js";import{d as H}from"./DefaultLayout-CrjhFOCs.js";import{u as Y,b as V}from"./UserRequest-bfq1Rb7a.js";import{C as g}from"./CustomSelect-BVXkPcO2.js";import{a as J}from"./index.esm-DJsCAX2S.js";import"./isSymbol-ByaixRsz.js";import"./CConditionalPortal-DZpQ5pqL.js";import"./CFormLabel-Dy6tVY1e.js";const K=(m,N)=>async(c,x)=>{var a;c({type:"UPDATE_START"});try{const i=await V(m,N);if(console.log("Update Response -",i),(a=i==null?void 0:i.data)!=null&&a.status){const{auth:d}=x(),p=typeof d.authData=="string"?JSON.parse(d.authData):d.authData,I={...p,profile_completeness:i.data.profile_completeness,user:{...p.user,...i.data.data},token:d.token};return c({type:"AUTH_SUCCESS",payload:I}),c({type:"PROFILE_COMPLETENESS_SUCCESS",payload:i.data.profile_completeness}),{success:!0,data:i.data}}}catch(i){console.log("Update failed -",i),c({type:"UPDATE_FAILED"})}},W=m=>async N=>{try{return(await Y(m)).data}catch(c){return console.log(c),c}},ce=()=>{const m=w(),N=F(),{return_url:c,announcement:x}=N.state||{},a=U(t=>t.auth.authData),i=$(),[d,p]=f.useState(!1),[I,C]=f.useState(null),[v,_]=f.useState({countries:[],districts:[],provinces:[]}),D=f.useRef(null),R=()=>{D.current.click()};f.useEffect(()=>{async function t(){var r,n,s;try{const[h,u,b]=await Promise.all([y.get("https://careers.usindh.edu.pk/backend/api/countries"),a.user.PROVINCE_ID&&y.get(`https://careers.usindh.edu.pk/backend/api/districts/${a.user.PROVINCE_ID}`),(a.user.COUNTRY_ID||160)&&y.get(`https://careers.usindh.edu.pk/backend/api/provinces/${a.user.COUNTRY_ID||160}`)]);_({countries:((r=h.data)==null?void 0:r.options)||[],districts:((n=u==null?void 0:u.data)==null?void 0:n.options)||[],provinces:((s=b==null?void 0:b.data)==null?void 0:s.options)||[]})}catch(h){console.error("Error fetching data:",h)}}t()},[]);const S=async t=>{if(!t){_(r=>({...r,provinces:[]}));return}try{const r=await y.get(`https://careers.usindh.edu.pk/backend/api/provinces/${t}`);_(n=>{var s;return{...n,provinces:((s=r.data)==null?void 0:s.options)||[]}})}catch(r){console.error("Error fetching provinces:",r)}},q=async t=>{if(!t){_(r=>({...r,provinces:[]}));return}try{const r=await y.get(`https://careers.usindh.edu.pk/backend/api/districts/${t}`);_(n=>{var s;return{...n,districts:((s=r.data)==null?void 0:s.options)||[]}})}catch(r){console.error("Error fetching districts:",r)}},A=E(v.districts,"DISTRICT_ID","DISTRICT_NAME"),T=E(v.provinces,"PROVINCE_ID","PROVINCE_NAME"),P=E(v.countries,"COUNTRY_ID","COUNTRY_NAME"),k={first_name:a.user.FIRST_NAME||"",last_name:a.user.LAST_NAME||"",fname:a.user.FNAME||"",cnic_no:a.user.CNIC_NO||"",email:a.user.EMAIL||"",mobile_no:a.user.MOBILE_NO||"",home_address:a.user.HOME_ADDRESS||"",permanent_address:a.user.PERMANENT_ADDRESS||"",date_of_birth:a.user.DATE_OF_BIRTH?new Date(a.user.DATE_OF_BIRTH):"",place_of_birth:a.user.PLACE_OF_BIRTH||"",district_id:parseInt(a.user.DISTRICT_ID)||0,province_id:parseInt(a.user.PROVINCE_ID)||0,country_id:parseInt(a.user.COUNTRY_ID)||160,religion:a.user.RELIGION?a.user.RELIGION.toLowerCase():"",nationality:parseInt(a.user.COUNTRY_ID)||"",gender:a.user.GENDER||"",marital_status:a.user.MARITAL_STATUS||0,domicile_province:a.user.PROVINCE_ID||0,profile_image:a.user.PROFILE_IMAGE||null},M=B({first_name:o().required("Name is required!"),last_name:o().required("Surname is required!"),cnic_no:o().matches(/^\d{13}$/,"CNIC No. invalid!").required("CNIC is required!"),mobile_no:o().required("Mobile No. required"),email:o().email("Invalid email format").required("Email is required!"),date_of_birth:o().required("Date of birth required"),gender:o().required("Gender is required!"),marital_status:o().required("Marital Status is required!"),place_of_birth:o().required("Place of Birth is required!"),religion:o().required("Religion is required!"),country_id:o().required("Country is required!"),province_id:o().required("Province is required!"),district_id:o().required("District is required!")}),L=async(t,{setFieldValue:r,resetForm:n})=>{if(p(!0),t.date_of_birth=t.date_of_birth?new Date(t.date_of_birth).toISOString().split("T")[0]:null,t.profile_image&&typeof t.profile_image=="object"&&t.profile_image.name!==void 0&&t.profile_image!==a.user.PROFILE_IMAGE){const s=new FormData,h=Date.now()+t.profile_image.name;s.append("profile_image",h),s.append("file",t.profile_image);try{const u=await i(W(s));t.profile_image=u.path}catch(u){console.log(u.response.data.error_message)}}try{const s=await i(K(t,a.user.USER_ID));s!=null&&s.success?(c!={}&&m(c,{state:{announcement:x}}),j({status:!0,text:"Profile Saved."}),r("profile_image",null)):j({status:!1,text:"Failed to save profile."})}catch(s){console.error("Error updating profile:",s),j({status:!1,text:"An error occurred."})}p(!1),n({values:t})};return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center flex-wrap",children:[e.jsx("div",{className:"profile-img position-relative",children:e.jsx("img",{src:I||(a.user.PROFILE_IMAGE?"https://careers.usindh.edu.pk/resource/uploads/"+a.user.PROFILE_IMAGE:H),width:150,height:150,className:"rounded-circle border border-2 cursor-pointer",alt:"Profile",style:{objectFit:"cover"}})}),e.jsxs("div",{className:"basic-info",children:[e.jsx("h1",{children:`${a.user.FIRST_NAME||""} ${a.user.LAST_NAME}`}),e.jsx("p",{className:"lead",children:a.user.EMAIL||""}),e.jsx(J,{variant:"light",className:"btn btn-outline-success btn-sm",onClick:R,children:"Upload Picture"})]})]}),e.jsx(O,{initialValues:k,validationSchema:M,onSubmit:L,children:({setFieldValue:t})=>e.jsxs(G,{encType:"multipart/form-data",children:[e.jsx("input",{name:"profile_image",accept:"image/*",id:"contained-button-file",type:"file",hidden:!0,onChange:r=>{const n=r.target.files[0];n&&(t("profile_image",n),C(URL.createObjectURL(n)))},ref:D}),e.jsx("div",{className:"form-group",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",type:"text",label:"Name",name:"first_name",required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",type:"text",label:"Surname",name:"last_name",required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",type:"text",label:"Father's Name",name:"fname",required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",type:"text",label:"CNIC No.",name:"cnic_no",disabled:!0,onInput:r=>{r.target.value=r.target.value.replace(/\D/g,"").slice(0,13)}})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",type:"text",label:"Mobile No.",name:"mobile_no",required:!0,onInput:r=>{r.target.value=r.target.value.replace(/\D/g,"").slice(0,11)}})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(g,{className:"form-control mt-2",options:[{key:"islam",value:"Islam"},{key:"christianity",value:"Christianity"},{key:"hinduism",value:"Hinduism"},{key:"other",value:"Other"}],label:"Religion",name:"religion",id:"religion",onChange:r=>{t("religion",(r==null?void 0:r.key)||"")}})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"radio",label:"Gender",name:"gender",required:!0,options:[{key:"M",value:"Male"},{key:"F",value:"Female"}]})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"radio",label:"Marital Status",name:"marital_status",required:!0,options:[{key:1,value:"Single"},{key:2,value:"Married"},{key:3,value:"Widowed"},{key:4,value:"Divorced"}]})}),e.jsx("div",{className:"col-sm-3 my-2",children:e.jsx(l,{className:"form-control mt-2",control:"date",type:"date",label:"Date of Birth",name:"date_of_birth",required:!0})}),e.jsx("div",{className:"col-sm-3 my-2",children:e.jsx(l,{className:"form-control mt-2",control:"input",type:"text",label:"Place of Birth",name:"place_of_birth",required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",as:"textarea",label:"Present Address",name:"home_address",required:!0})}),e.jsxs("fieldset",{className:"border border-2 p-2",children:[e.jsx("legend",{className:"fw-bold",children:"Domicile Details"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(g,{className:"form-control mt-2",options:P,label:"Country",name:"country_id",onChange:r=>{t("country_id",(r==null?void 0:r.key)||""),S(r==null?void 0:r.key)},required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(g,{className:"form-control mt-2",options:T,label:"Domicile Province",name:"province_id",onChange:r=>{t("province_id",(r==null?void 0:r.key)||""),q(r==null?void 0:r.key)},required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(g,{className:"form-control mt-2",options:A,label:"Domicile District",name:"district_id",required:!0})}),e.jsx("div",{className:"col-sm-6 my-2",children:e.jsx(l,{control:"input",as:"textarea",label:"Permanent Address",name:"permanent_address",required:!0})})]})]})]})}),e.jsx("div",{className:"form-group text-center",children:e.jsx("button",{className:"btn btn-primary fs-5 rounded-pill my-2 p-2 px-4",type:"submit",disabled:d,children:d?"Saving...":"Save"})})]})})]})};export{ce as default};
