import{r as o,w as C,i as S,f as D,x as h,j as n,n as P,y as j,z as U}from"./index-DrpCck3H.js";import{D as M}from"./DynamicDataTable-CHQKT7te.js";import{g as v}from"./UtilRequest-82-ViOBi.js";import{C as I}from"./CustomSelect-DZveazcM.js";import{F as k,a as w}from"./formik.esm-DftA7rzV.js";import{c as L}from"./index.esm-Cv9wGfPn.js";import{a as R}from"./AnnouncementRequest-oTMmNYuw.js";import{g as F}from"./ApplicationRequest-CxnVmjDH.js";import"./isSymbol-B98uY8n-.js";import"./CConditionalPortal-C416BAvS.js";const K=()=>{const[d,p]=o.useState([]),u=C(),[A,x]=o.useState([]),[r,i]=o.useState([]),T=async()=>{var e;try{const t=await R();console.log(t),i((e=t.data)==null?void 0:e.data)}catch{}},N=S(),c=D(e=>e.applicationFilter.selectedDeptId),m=D(e=>e.applicationFilter.selectedAnnouncementId);o.useEffect(()=>{(async()=>{try{const t=await v();if(x(t.data),c){const s=t.data.find(a=>a.DEPT_ID==c);if(s&&(i(s.announcements),m)){const a=s.announcements.find(l=>l.ANNOUNCEMENT_ID==m);a&&p(a.applications)}}}catch(t){console.error("Error loading dept/announcement data",t)}})(),T()},[]);const f=o.useMemo(()=>h(A,"DEPT_ID","DEPT_NAME")),_=o.useMemo(()=>h(r,"ANNOUNCEMENT_ID","ANNOUNCEMENT_TITLE")),E=[{name:"ID",selector:e=>e.APPLICATION_ID,sortable:!0,width:"80px"},{name:"Candidate Name",selector:e=>e.FIRST_NAME+" "+e.LAST_NAME,sortable:!0,width:"250px",style:{minWidth:"250px",maxWidth:"300px"}},{name:"CNIC No.",selector:e=>e.CNIC_NO,sortable:!0,wrap:!0,style:{minWidth:"150px"}},{name:"Paid Amount",selector:e=>e.PAID_AMOUNT??"-",sortable:!0,width:"130px"},{name:"Apply Date",selector:e=>e.APPLY_DATE??"-",sortable:!0,style:{minWidth:"100px"}},{name:"Paid Date",selector:e=>e.PAID_DATE?P(e.PAID_DATE):"-",sortable:!0,width:"130px"},{name:"Status",selector:e=>e.APPLICATION_STATUS==1?"Applied":e.APPLICATION_STATUS==2?"Unpaid":e.APPLICATION_STATUS==4?"Shortlisted":e.APPLICATION_STATUS==3?"Recieved":"Rejected",sortable:!0,width:"100px"},{name:"Actions",cell:e=>n.jsxs("div",{className:"d-flex align-items-center flex-wrap gap-1",children:[n.jsx("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>{u("/admin/application/edit",{state:{prevData:e,announcement:r.filter(t=>t.ANNOUNCEMENT_ID===e.ANNOUNCEMENT_ID)}})},children:"View"}),n.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>{u("/admin/application/update-user",{state:{prevData:e}})},children:"Update User"}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",children:"Delete"})]}),ignoreRowClick:!0,width:"220px"}],b=(e,t)=>{t("dept_id",(e==null?void 0:e.key)||"");const s=(e==null?void 0:e.key)||"",a=A.filter(l=>l.DEPT_ID==e.key);N(j(s)),i(a[0].announcements)},g=async(e,t)=>{t("announcement_id",(e==null?void 0:e.key)||"");const s=(e==null?void 0:e.key)||"";r.find(a=>a.ANNOUNCEMENT_ID==(e==null?void 0:e.key)),N(U(s));try{const a=await F(s);p(a.data)}catch{}},y=Array.isArray(d)?d.map(e=>e):[];return n.jsxs("div",{className:"admin-dashboard",children:[n.jsx(k,{enableReinitialize:!0,initialValues:{dept_id:c,announcement_id:m},validationSchema:L({}),children:({setFieldValue:e})=>n.jsx(w,{children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"form-group col-6 my-2",children:n.jsx(I,{className:"form-control bg-primary text-light",label:"Select Department",name:"dept_id",options:f,onChange:t=>{b(t,e)},required:!0})}),n.jsx("div",{className:"form-group col-6 my-2",children:n.jsx(I,{className:"form-control bg-primary text-light",label:"Select Announcement",name:"announcement_id",options:_||[],onChange:t=>{g(t,e)},required:!0})})]})})}),n.jsx(M,{title:"Applications",columns:E,data:y})]})};export{K as default};
