import{r,A as y,i as S,f as D,H as h,j as n,q as P,I as j,J as U}from"./index-CFt1f066.js";import{D as M}from"./DynamicDataTable-BLKAN8eu.js";import{g as v}from"./UtilRequest-Dg_e8s70.js";import{C as I}from"./CustomSelect-BVXkPcO2.js";import{F as k,a as w}from"./formik.esm-DGj08CUs.js";import{c as L}from"./index.esm-g-bgoICI.js";import{a as R}from"./AnnouncementRequest-CvoZS0z3.js";import{g as F}from"./ApplicationRequest-BkvVguV1.js";import"./CConditionalPortal-DZpQ5pqL.js";import"./isSymbol-ByaixRsz.js";const K=()=>{const[d,p]=r.useState([]),u=y(),[A,x]=r.useState([]),[o,i]=r.useState([]),T=async()=>{var e;try{const t=await R();i((e=t.data)==null?void 0:e.data)}catch{}},N=S(),c=D(e=>e.applicationFilter.selectedDeptId),m=D(e=>e.applicationFilter.selectedAnnouncementId);r.useEffect(()=>{(async()=>{try{const t=await v();if(x(t.data),c){const s=t.data.find(a=>a.DEPT_ID==c);if(s&&(i(s.announcements),m)){const a=s.announcements.find(l=>l.ANNOUNCEMENT_ID==m);a&&p(a.applications)}}}catch(t){console.error("Error loading dept/announcement data",t)}})(),T()},[]);const f=r.useMemo(()=>h(A,"DEPT_ID","DEPT_NAME")),_=r.useMemo(()=>h(o,"ANNOUNCEMENT_ID","ANNOUNCEMENT_TITLE")),E=[{name:"ID",selector:e=>e.APPLICATION_ID,sortable:!0,width:"80px"},{name:"Candidate Name",selector:e=>e.FIRST_NAME+" "+e.LAST_NAME,sortable:!0,width:"250px",style:{minWidth:"250px",maxWidth:"300px"}},{name:"CNIC No.",selector:e=>e.CNIC_NO,sortable:!0,wrap:!0,style:{minWidth:"150px"}},{name:"Paid Amount",selector:e=>e.PAID_AMOUNT??"-",sortable:!0,width:"130px"},{name:"Apply Date",selector:e=>e.APPLY_DATE??"-",sortable:!0,style:{minWidth:"100px"}},{name:"Paid Date",selector:e=>e.PAID_DATE?P(e.PAID_DATE):"-",sortable:!0,width:"130px"},{name:"Status",selector:e=>e.APPLICATION_STATUS==1?"Applied":e.APPLICATION_STATUS==2?"Unpaid":e.APPLICATION_STATUS==4?"Shortlisted":e.APPLICATION_STATUS==3?"Recieved":"Rejected",sortable:!0,width:"100px"},{name:"Actions",cell:e=>n.jsxs("div",{className:"d-flex align-items-center flex-wrap gap-1",children:[n.jsx("button",{className:"btn btn-outline-warning btn-sm",onClick:()=>{u("/admin/application/edit",{state:{prevData:e,announcement:o.filter(t=>t.ANNOUNCEMENT_ID===e.ANNOUNCEMENT_ID)}})},children:"View"}),n.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>{u("/admin/application/update-user",{state:{prevData:e}})},children:"Update User"}),n.jsx("button",{className:"btn btn-outline-danger btn-sm",children:"Delete"})]}),ignoreRowClick:!0,width:"220px"}],b=(e,t)=>{t("dept_id",(e==null?void 0:e.key)||"");const s=(e==null?void 0:e.key)||"",a=A.filter(l=>l.DEPT_ID==e.key);N(j(s)),i(a[0].announcements)},C=async(e,t)=>{t("announcement_id",(e==null?void 0:e.key)||"");const s=(e==null?void 0:e.key)||"";o.find(a=>a.ANNOUNCEMENT_ID==(e==null?void 0:e.key)),N(U(s));try{const a=await F(s);p(a.data)}catch{}},g=Array.isArray(d)?d.map(e=>e):[];return n.jsxs("div",{className:"admin-dashboard",children:[n.jsx(k,{enableReinitialize:!0,initialValues:{dept_id:c,announcement_id:m},validationSchema:L({}),children:({setFieldValue:e})=>n.jsx(w,{children:n.jsxs("div",{className:"row",children:[n.jsx("div",{className:"form-group col-6 my-2",children:n.jsx(I,{className:"form-control bg-primary text-light",label:"Select Department",name:"dept_id",options:f,onChange:t=>{b(t,e)},required:!0})}),n.jsx("div",{className:"form-group col-6 my-2",children:n.jsx(I,{className:"form-control bg-primary text-light",label:"Select Announcement",name:"announcement_id",options:_||[],onChange:t=>{C(t,e)},required:!0})})]})})}),n.jsx(M,{title:"Applications",columns:E,data:g})]})};export{K as default};
