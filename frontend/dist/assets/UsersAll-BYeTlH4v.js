import{r as o,j as s,A as E,f as I,B as k}from"./index-BFSWvyhh.js";import{D as C}from"./DynamicDataTable-DMTjRBex.js";import{a as U}from"./UserRequest-DzQgP5aF.js";import{F as g,a as y}from"./formik.esm-Bg87zhII.js";import{c as N,a as F}from"./index.esm-DKed_wgO.js";import{M as O}from"./Modal-CEpq9wQ8.js";import{F as v}from"./FormControl-BQZGBokq.js";import{a as M,r as L}from"./UtilRequest-82-ViOBi.js";import{A as h}from"./Alert-CXLFhIlH.js";import{A as V}from"./AlertConfirm-MJ-uUc8x.js";import{C as j}from"./DefaultLayout-DOplUsjh.js";import"./isSymbol-B98uY8n-.js";import"./CConditionalPortal-DaAJL4r3.js";import"./CFormLabel-CbVdSG0w.js";import"./index.esm-BvQuuiUP.js";import"./AuthAction-Bnnw91pu.js";const T=({user:c,onRoleUpdate:u})=>{const[p,l]=o.useState(!1),[i,x]=o.useState(c.user_roles),R=async r=>{var a;l(!0);try{const m={R_R_ID:(await M(r)).data.role.R_R_ID,role:{ROLE_ID:parseInt(r.role_id),ROLE_NAME:E(r.role_id)}};x([...i,m]),h({status:!0,text:"Role assigned successfully..."}),u()}catch(t){h({status:!1,text:((a=t.response.data)==null?void 0:a.error_message)||"Some error occurred!"})}l(!1)},d=N({role_id:F().required("Role is required!")}),f=async r=>{try{if(await V({title:"Delete role?",text:"This action cannot be undone."})){const t=await L(r);x(i.filter(m=>m.R_R_ID!==r)),h({status:!0,text:"Role removed successfully..."}),u()}}catch{h({status:!1,text:"Unable to remove this role!"})}};return s.jsx("div",{children:s.jsx(g,{initialValues:{role_id:"",user_id:c.USER_ID},validationSchema:d,onSubmit:R,children:({values:r,setFieldValue:a})=>s.jsxs(y,{children:[s.jsxs("div",{children:["Existing Roles: ",i.length>0?i.map(t=>s.jsxs(j,{color:"warning",className:"position-relative text-black p-1 mx-2",children:[t.role.ROLE_NAME,s.jsx("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger btn fw-bolder",onClick:()=>{f(t.R_R_ID)},children:"X"})]},t.R_R_ID)):"No role assigned yet."]}),s.jsx(v,{control:"select",name:"role_id",id:"role_id",label:"Assign New",required:!0,options:[{key:1,value:"Super Admin"},{key:2,value:"Admin"},{key:3,value:"Operator"},{key:4,value:"Primary"}]}),s.jsx("button",{className:"btn btn-primary my-3",type:"submit",disabled:p,children:p?"Saving":"Save"})]})})})},te=()=>{const[c,u]=o.useState([]),[p,l]=o.useState([]),[i,x]=o.useState({}),[R,d]=o.useState(!1),f=I(e=>e.roles.selectedRole),r=e=>{d(!0),x(e)},a=()=>{d(!1)},t=async()=>{try{const e=await U();u(e.data.data),l(e.data.data)}catch{}};o.useEffect(()=>{t()},[]);const m=[{name:"ID",selector:e=>e.USER_ID,sortable:!0,width:"80px"},{name:"Name",selector:e=>k(e.FIRST_NAME,e.LAST_NAME),sortable:!0,width:"250px"},{name:"Father's Name",selector:e=>e.FNAME,sortable:!0,width:"250px"},{name:"CNIC No.",selector:e=>e.CNIC_NO,sortable:!0,style:{width:"50px"}},{name:"Roles",selector:e=>e.user_roles.map(n=>s.jsx(j,{className:"m-1 text-dark",color:"warning",children:n.role.ROLE_NAME},n.role.ROLE_ID)),sortable:!0,wrap:!0,style:{width:"50px"}},{name:"Actions",cell:e=>f==1?s.jsx("div",{className:"d-flex align-items-center flex-wrap gap-1",children:s.jsx("button",{className:"btn btn-outline-success btn-sm",onClick:()=>{r(e)},children:"Edit Role"})}):"-",ignoreRowClick:!0,width:"150px"}],A=(e,n)=>{const _=e.target.value;if(n("role_id",_||""),_!=5){const S=c.filter(w=>{var b;return(b=w.user_roles)==null?void 0:b.some(D=>D.ROLE_ID==_)});l(S)}else l(c)};return s.jsxs("div",{className:"admin-dashboard",children:[s.jsx(g,{initialValues:{role_id:5},validationSchema:N({}),children:({setFieldValue:e})=>s.jsx(y,{children:s.jsx("div",{className:"row",children:s.jsx("div",{className:"form-group col-3 my-2",children:s.jsx(v,{control:"select",className:"form-control",name:"role_id",id:"role_id",label:"",options:[{key:5,value:"All"},{key:1,value:"Super Admin"},{key:2,value:"Admin"},{key:3,value:"Operator"},{key:4,value:"Primary"}],onChange:n=>{A(n,e)}})})})})}),s.jsx(C,{title:"Users",columns:m,data:p}),s.jsx(O,{setVisible:d,visible:R,size:"md",position:"center",onClose:a,children:s.jsx(T,{user:i,onRoleUpdate:()=>{t()}})})]})};export{te as default};
